---
title: "R Graphics:  worked examples"
author: "Mark Dunning"
date: "09/09/2014"
output: pdf_document
toc: true
---
#Introduction

This document describes how basic statistical analysis and graphical displays can be performed using R. 

The different data types are categorised according to the different options available in GraphPad Prism.

# XY data

##Linear regression

###Data exploration

Example data for this example is given in the file `Linear regression.txt`
```{r echo=FALSE}
myfile <- "PrismExamples/XY/Linear regression.txt"
```

```{r eval=FALSE}
myfile <- file.choose()
```

We know that the input file is *tab-delimited*, so can use the `read.delim` function. Once the data are read, we 
print out the first few rows using `head` and print the dimensions
```{r}
data <- read.delim(myfile,as.is=TRUE)
head(data)
dim(data)
```

You many notice that a number of entries are listed `NA`. This simply means that these observations are *missing* and should be excluded from numerical calculations. 

The generic `plot` function is able to make a scatter plot of one variable against another. By default we specify the *vector* we want to plot on the x-axis first, followed by a *vector* to be displayed on the y-axis. To extract vectors from our data frame, we can use the `[row,column]` notation, or specify the name of the column with a `$` sign. We will start by the `Control` column against number of minutes. 

```{r}
plot(data$Minutes, data$Control)
```

The default settings will plot open circles at every *x* and *y* position specified by the two input vectors. If we want a line through the coordinates, we can modify the `type` argument to `"l"`.

```{r}
plot(data$Minutes, data$Control,type="l")
```

Or we can have a combination of points and a line by setting `type="b"`

```{r}
plot(data$Minutes, data$Control,type="b")
```

We can put additional lines on the plot, in this case corresponding to other experiments, using the `lines` function. This function assumes that a plot has already been created. We can add a line at a time by specifying different columns from the data frame as our *y* axis in the `lines` function.

```{r}
plot(data$Minutes, data$Control,type="l")
lines(data$Minutes, data$Control.1)
lines(data$Minutes, data$Control.2)
lines(data$Minutes, data$Treated)
lines(data$Minutes, data$Treated.1)
lines(data$Minutes, data$Treated.2)
```

You will notice however that some of the lines go outside the plotting area. This is because the range of y values for the plot is defined using the range of the first line that we plotted (the `data$Control` vector). We can specify a particular range of values using the `ylim` argument to `plot`. A sensible value to use would be the *maximum* value in our data frame. However, there is a problem when we try and calculate this.

```{r}
max(data)
```
Because we have `NA` values in the data frame, the maximum value cannot be determined. That is, unless, we use the argument `na.rm=TRUE`

```{r}
max(data,na.rm=TRUE)
```

We can now specify the y limits for the plot using the `ylim` argument. This argument needs to be a vector (hence we use the `c` function to construct it) consisting the minimum and maximum y values for the plot.

```{r}
plot(data$Minutes, data$Control,type="l",ylim=c(0,max(data,na.rm=TRUE)))
lines(data$Minutes, data$Control.1)
lines(data$Minutes, data$Control.2)
lines(data$Minutes, data$Treated)
lines(data$Minutes, data$Treated.1)
lines(data$Minutes, data$Treated.2)
```

We have managed to display the raw data on a plot, but it is unlikely to win any prizes for being aesthetically pleasing! A couple of obvious modifications would be to add a proper x and y label, and to colour the lines appropriately. To change the labels we can specify the `xlab`, `ylab` and `main` arguments. 

```{r}
plot(data$Minutes, data$Control,type="l",ylim=c(0,max(data,na.rm=TRUE)),col="blue",xlab="Minutes",ylab="Count",main="Variation of counts....")
lines(data$Minutes, data$Control.1,col="blue")
lines(data$Minutes, data$Control.2,col="blue")
lines(data$Minutes, data$Treated,col="red")
lines(data$Minutes, data$Treated.1,col="red")
lines(data$Minutes, data$Treated.2,,col="red")
```


# Column data

##Frequency distribution data

Example data for this section is given in the Frequency distribution data.txt

```{r echo=FALSE}
myfile <- "PrismExamples/Column/Frequency distribution data.txt"
```

```{r eval=FALSE}
myfile <- file.choose()
```


```{r}

data <- read.delim(myfile)
```

We can make a histogram using the `hist` function

```{r}
hist(data$Frequency,col="black",main="Frequency distribution data")
```


```{r}
plot(data$Frequency,pch=16,main="Frequency distribution data")
```

```{r}
plot(data$Frequency,pch=16,main="Frequency distribution data",type="b")
```

##Unpaired t test

The data for this example can be found in the file *Unpaired t test data.txt*. The first step is to locate the file on your disk using the `file.choose()` command and store the result as a variable. 


```{r echo=FALSE}
myfile <- "PrismExamples/Column/Unpaired t test data.txt"
```

```{r eval=FALSE}
myfile <- file.choose()
```

We can now read the file using the `read.delim` function.

```{r}
data <- read.delim(myfile)
data
```

The data consist of `r nrow(data)` rows and `r ncol(data)` columns. The `t.test` function can be to test the null hypothesis that the two groups have the same mean value. The default is to assume that the groups are independent. 

```{r}
t.test(data$Male, data$Female)
```

We can use a boxplot to visualise the data. 


```{r}
boxplot(data)
```

Sometimes we might want to present the observations as points on the graph. We can do this using the `points` function

```{r}
boxplot(data)
points(rep(1, nrow(data)), data[,1],pch=16)
points(rep(2, nrow(data)), data[,2],pch=16)

```

##Paired t test


The data for this example can be found in the file *Paired t test data.txt*. The first step is to locate the file on your disk using the `file.choose()` command and store the result as a variable. 


```{r echo=FALSE}
myfile <- "PrismExamples/Column/Paired t test data.txt"
```

```{r eval=FALSE}
myfile <- file.choose()
```

We can now read the file using the `read.delim` function.

```{r}
data <- read.delim(myfile)
data
```

```{r}
t.test(data$Control, data$Treated,paired=TRUE)
```

```{r}
boxplot(data[,-1])
```

```{r}
boxplot(data[,-1],horizontal = TRUE)
```

#Survival

##Comparing two groups


The data for this example can be found in the file *Two groups.txt*. The first step is to locate the file on your disk using the `file.choose()` command and store the result as a variable. 


```{r echo=FALSE}
myfile <- "PrismExamples/Survival//Two groups.txt"
```

```{r eval=FALSE}
myfile <- file.choose()
```

We can now read the file using the `read.delim` function.

```{r}
data <- read.delim(myfile)
data
```

Survival analysis is performed by a specialist package `survival` which is part of the standard R distribution. The first task is therefore to load this package, which you only have to do once per R-session.


```{r}
library(survival)
```

The data from Prism require some manipulation before we can apply the survival analysis. Specifically, we need to create *vectors* that contain data about the Time to event, Event and Group. The Time variable

```{r}
Time <- data$Days.elapsed

Group <- rep("Control", nrow(data))
Group[which(is.na(data$Control))] <- "Treatment"
Group

Event <- data$Control
Event[which(is.na(data$Control))] <- data$Treated[which(is.na(data$Control))]
Event
```

The time and data need to be combined into a single vector

```{r}
survData <- Surv(Time, Event)
survData
```


```{r}
plot(survfit(survData~Group))

plot(survfit(survData~Group),col=c("red","blue"),xlab="Days elapsed", 
     main="Survival proportions: Survival of Two groups",
     ylab="Percent survival")

```


```{r}
survdiff(survData~Group)

```


##Comparing three groups


The data for this example can be found in the file *Two groups.txt*. The first step is to locate the file on your disk using the `file.choose()` command and store the result as a variable. 


```{r echo=FALSE}
myfile <- "PrismExamples/Survival//Three groups.txt"
```

```{r eval=FALSE}
myfile <- file.choose()
```

We can now read the file using the `read.delim` function.

```{r}
data <- read.delim(myfile)
data
```


The data from Prism require some manipulation before we can apply the survival analysis. Specifically, we need to create *vectors* that contain data about the Time to event, Event and Group. The Time variable can simply be assigned as the `Days` column. However, to get the other two vectors requires a bit more effort.

```{r}
Time <- data$Days

Group <- rep("Control", nrow(data))
Group[which(!is.na(data$Treatment.A))] <- "TreatmentA"
Group[which(!is.na(data$Treatment.B))] <- "TreatmentB"

Group

Event <- data$Control
Event[which(!is.na(data$Treatment.A))] <- data$Treatment.A[which(!is.na(data$Treatment.A))]
Event[which(!is.na(data$Treatment.B))] <- data$Treatment.B[which(!is.na(data$Treatment.B))]
Event
```



The time and data need to be combined into a single vector

```{r}
survData <- Surv(Time, Event)
survData
```


```{r}
plot(survfit(survData~Group))

plot(survfit(survData~Group),col=c("red","blue","green"),xlab="Days elapsed", 
     main="Survival proportions: Survival of Three groups",
     ylab="Percent survival")

```


```{r}
survdiff(survData~Group)

```