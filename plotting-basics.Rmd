---
title: "Plotting Basics"
author: "Mark Dunning"
date: "12/12/2014"
output: beamer_presentation
---

#The scatter plot

## Introducing the dataset
These data were obtained from the [supplementary data](http://faculty.washington.edu/heagerty/Books/Biostatistics/index-chapter.html) to *Biostatistics: A Methodology for the Health Sciences*


```{r echo=FALSE}
if(!file.exists("data/ozone.csv")) download.file(url = "http://faculty.washington.edu/heagerty/Books/Biostatistics/DATA/ozone.csv", destfile = "data/ozone.csv")
```


You can load these data into Excel for reference

##Reading the data

To import these data into R we use the `read.csv` function, which will create a *data-frame* representation

```{r}
data <- read.csv("data/ozone.csv")
```


## Exploring the data

You should **always check** that the data have been imported correctly by previewing and checking the *dimensions*.


```{r}
head(data)
dim(data)
```

## Exploring the data

```{r}
summary(data)
str(data)
```

##Data representation

The data are stored in a data frame. These are subset using square brackets `[]`

e.g. print rows 1 to 10 from the first column
```{r}
data[1:10,1]
```

##Data representation

We can get entire columns and rows by *omitting* the row or column index. The result is a `vector`

```{r}
data[1,]
data[,1]
```

##Data representation

The data frame is *not altered*

```{r}
dim(data)
data[1,]
dim(data)
```

##About NA

- You may have noticed some `NA` entries in the vector
- This is R's way of denoting *missing values*



##Assignment to a variable

Again, the result is a `vector`
```{r}
ozone <- data$Ozone
```


##Thinking about the data
What variables do we have?

- Ozone, Wind, Temp (Continuous)
- Month, Day (Discrete)

What are we interested in?

- Trend
- Relationship

Any repeated observations?

- No

##Scatter plots 

Suppose we want to look at the change in Ozone level (continuous)

- `plot` is the general-purpose plotting function in R
- Given a *vector* it will plot the values in the vector on the **y** axis, and index on the **x** axis

```{r fig.width=8,fig.height=4}
plot(data$Ozone)
```

##Scatter plots 

- We have `r nrow(data)` points on the plot
- Axis labels, points, title and colours can be altered (see later)

```{r fig.width=8,fig.height=4}
plot(data$Ozone)
```


##Data visualisation

- Can plot one vector against another
- First *argument* is plotted on the x axis, second *argument* on the y axis

```{r fig.width=8,fig.height=4}
plot(data$Ozone,data$Wind)
```



##Multiple comparisons

- The `plot` function will try and *guess* what plot to make based on the data
- If given a *data frame* it make pairwise comparisons of all columns

```{r}
plot(data[,1:4])
```


#Visualising Distributions

##The dataset

We have made some observations of cell in different conditions

- Three different groups (categories) in the dataset
- Repeated measurements for each group
- Are the data distributed differently in the different groups?

```{r}
data <- read.delim("data/plasma.txt")
data
```

##The data

The data are stored in a data frame

##The boxplot

```{r fig.width=8,fig.height=4}
boxplot(data)
```


##Plotting individual points

- `vertical = TRUE` ensures the plot is in the same orientation as the boxplot

```{r fig.width=8,fig.height=4}
stripchart(data,vertical=TRUE)
```

##Plotting individual points

- We can *stack* or *jitter* points if required

```{r fig.width=8,fig.height=4}
stripchart(data,vertical=TRUE,method="jitter")
```

##Plotting individual points
```{r}
library(beeswarm)
beeswarm(data,vertical=TRUE)
```



##Overlaying points

- `add=TRUE` argument overlays the stripchart on an existing plot

```{r fig.width=8,fig.height=4}
boxplot(data)
stripchart(data,vertical=TRUE,add=TRUE)

```


##Summarising the data

```{r}
summary(data)
```


##Bar plots

To display the data as a barplot, we need to compute the mean of each *column*. The `colMeans` function is convenient for this.

```{r fig.width=8,fig.height=4}
barplot(colMeans(data))
```

N.B. see also `rowMeans`, `colSums`, `rowSums`

##Calculating error bars

To add *error bars* we need to calculate the standard deviations

```{r}
sd(data$Untreated)
sd(data$Placebo)
sd(data$Treated)
```


##Adding error bars

```{r echo=FALSE}
dpPlot <- function(data){
  
  mns <- colMeans(data,na.rm=TRUE)
  sds <- apply(data, 2, sd, na.rm=TRUE)
  
  err <- mns + sds
  xs <- barplot(mns,ylim=c(0, max(err)),axes=F)
  
  arrows(xs, mns, xs, err,code=3,angle=90)
  axis(2,at=pretty(0:floor(max(err))))
}
```

```{r}
dpPlot(data)
```


##We can still overlay points

```{r echo=FALSE,fig.show='hide'}
bp <- barplot(colMeans(data))

```

```{r echo=FALSE}
dpPlot(data)
points(rep(bp, each=nrow(data)), unlist(data))
```


##What to do with long data

- Recall our weather data
- We do not have separate columns for each month

```{r}
data <- read.csv("data/ozone.csv")
head(data)
```

##Boxplot of long data

- Month is a variable in the data frame
- We use *formula* syntax with the `~` symbol

```{r}
boxplot(data$Ozone~data$Month)
```

##Boxplot of long data

```{r}
boxplot(data$Temp~data$Month)
```

##stripchart of long data

```{r}
stripchart(data$Ozone~data$Month,vertical=TRUE)
```

##Boxplot of long data

```{r}
boxplot(data$Ozone~data$Month)
stripchart(data$Ozone~data$Month,vertical=TRUE,add=TRUE)
```

##Boxplot of long data

- This is equivalent and a bit more concise
```{r}
boxplot(Ozone~Month,data)
stripchart(Ozone~Month,data,vertical=TRUE,add=TRUE)
```

##Melting a dataset

We can convert a dataset from *wide* to *long* using the `reshape` package

```{r}
library(reshape2)
data <- read.delim("data/plasma.txt")
plasma <- melt(data)
dim(plasma)
head(plasma)
```

##Boxplot of the new data

- Compare to before...

```{r}
boxplot(value ~ variable,plasma)
```



#Count data

##Making a barplot

```{r fig.width=8,fig.height=4}
clinical <- read.delim("data/NKI295.pdata.txt")
table(clinical$ER)
barplot(table(clinical$ER))
```

##Making a barplot
```{r fig.width=4,fig.height=4}
pie(table(clinical$ER))
```

##Stacking 

```{r fig.width=8,fig.height=4}
table(clinical$ER,clinical$grade)
barplot(table(clinical$grade,clinical$ER))
```

##Stacking 

```{r fig.width=8,fig.height=4}
table(clinical$ER,clinical$grade)
barplot(table(clinical$grade,clinical$ER),beside=TRUE)
```

#Curves

##Survival curves

![Survival Curve](images//Surv.jpg)

##Survival curves


To perform a survival analysis we need the following pieces of information

- Time to Event
- Event (e.g. dead or alive)
- Group

##Example data

```{r}
clinical <- read.delim("data/NKI295.pdata.txt")

Event <- clinical$event_death
Time <- clinical$survival.death.
Group <- clinical$ER

```

##The survival package

```{r}
library(survival)
survData <- Surv(Time, Event)
survData[1:10]
```


##Making the Survival curve

```{r}
plot(survfit(survData ~ Group))
```

##Testing

```{r}
survdiff(survData~Group)
```

##Growth Curve

Goal is to produce following 
![Growth Curve](images//LinearRegression.jpg)

##Growth Curve

```{r}
data <- read.delim("PrimerExamples/Linear regression.txt")
head(data)
```

##Thinking about the data

Variables in the data 

- Time 
- Count 
- Group (Control vs Treatment)

Want to visualise difference in treatment over time


##Procedure


