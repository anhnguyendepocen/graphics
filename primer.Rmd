---
title: 'Data  Manipulation and Visualisation: An R primer'
author: "Mark Dunning"
date: "09/09/2014"
output: pdf_document
toc: yes
---

#Introduction

This document will guide you through the key concepts and techniques required to manipulate and process data in R.

1. Read the data into R
  + What format are the data in? 
2. Manipulate the data
  + What columns / rows are needed for the analysis? Do any additional calculations need to be performed?
3. Plot the data
  + What type of plot do you need to convey your message? What type of data do you need for the plot
  
  
##About this document

This document was written in RStudio using the **markdown** format. If you see a section like this, you can copy-and-paste the text into RStudio and execute it. 
 
```{r eval=FALSE}
print("Hello World")
```


Often the output from R will be displayed after the R command

```{r}
print("Hello World")
```

Sometimes the graphics produced by R will be displayed too.

```{r}
plot(runif(1:10))
```

#Reading data into R

##Specify a path to the file

R needs to know where the file is located on your hard drive in order to read it. If the file is located within your *working directory* then you can just specify the name of the file. You can find out the location of your working directory using the `getwd` function.

```{r eval=FALSE}
getwd()
```

If the file is not in your working directory, then you will need to specify the full path to the file. A useful function in this situation is `file.choose`, which will open a dialog box allowing you to navigate to the file. The location can be stored as a variable.

```{r eval=FALSE}
myfile <- file.choose()
```

When specifying the file location, it has to giving within *quote marks*, as in the following example


```{r}
myfile <- "PrimerExamples/Indepentent two-sample t-test_v2_long.txt"
```

We will now discuss various ways of loading tabular data into R. The examples should cover most file types that you might encounter (e.g. csv, txt, tsv, xlsx files). If you have an example file that doesn't seem to fit any of these example, please let us know. Please note that R is not able to import GraphPad Prism files, as this file format is proprietary. You will have to use a commercial version of Prism to export the data table into a text-file. 

Once a file has been read into R, we recommend that you **check the dimensions and contents**. Sometimes R will read a file without error, but may not have been able to interpret the structure of the data correctly, which will cause problems for further analysis.

##Tab-delimited file

As a *rule-of-thumb*, tab-delimited files have file extensions *.txt* or *.tsv*. If your file is tab-delimited and you have specified the location using the previous section, you will be able to use the `read.delim` function. The `file.exists` is a useful function for checking that the file location is correct; returning `TRUE` if so.

```{r}
myfile <- "PrimerExamples/Indepentent two-sample t-test_v2_long.txt"
file.exists(myfile)
mydata <- read.delim(myfile)
```

Assuming that the function does not produce an error, you should now have a variable `mydata` in your R workspace. This is *data frame* object, described in more detail in the [Appendix](#Appendix). At this point, it is highly recommended that you check the contents of the variable. The `View` command should open a new tab in RStudio.

```{r eval=FALSE}
View(mydata)
```

The dimensions and structure of the data can be further interrogated using the following useful functions.

```{r}
dim(mydata)
str(mydata)
head(mydata)
```

In this case, the object has `r ncol(mydata)` columns and `r nrow(mydata)` rows; as we would expect.

Now notice what happens if we read the file by (incorrectly) calling the `read.csv` function on a *tab-delimited* file

```{r}
myfile <- "PrimerExamples/Indepentent two-sample t-test_v2_long.txt"
mydata <- read.csv(myfile)
dim(mydata)
str(mydata)
head(mydata)
```

R was able to read the file without error, but the dimensions of the resulting object are incorrect.

##Comma-separated file

Files that have columns separated by commas can be read using the `read.csv` function. The file location needs to be specified by either using the `file.choose` function as follows;

```{r eval=FALSE}
myfile <- file.choose()
```

Or by specifying the path to the file within quote marks. Once the file has been read, we check the dimensions and general structure.


```{r}
myfile <- "PrimerExamples/One-sample t-test.csv"
mydata <- read.csv(myfile)

dim(mydata)
str(mydata)
head(mydata)
```


##Excel file

R is even able to read Excel spreadsheets. This requires an additional *package* to be installed; `gdata`. This package is loaded as follows;

```{r}
library(gdata)
```


If you do not have `gdata` installed you will get an error message in the following form.

```{r echo=FALSE,warning=FALSE}

error <- try(library(foo),silent = TRUE)
error[1]
```

If this error occurs, the package will need to be installed and then loaded
```{r,eval=FALSE}
install.packages("gdata")
library(gdata)
```

We can now call the `read.xls` function from `gdata`

```{r}
myfile <- "PrimerExamples//Indepentent two-sample t-test_v2_long.xlsx"

mydata <- read.xls(myfile)
head(mydata)
```

##SPSS file

##Further options for reading files
Sometimes we might be faced with 'messy' data that do not have a straightforward format of rows and columns. 
`read.csv` and `read.delim` are in fact specialised versions of a generic `read.table` function. This function has many options to allow finer-grain control over how files are read into R, as you will see from the manual page. 

```{r eval=FALSE}
?read.table
```

###Skipping lines

```{r eval=FALSE}
mydata <- read.delim(myfile, skip=)
```

```{r eval=FALSE}
mydata <- read.delim(myfile, nrows=3)
```



###Invalid characters

```{r}

```


###Strings as factors

#Writing data to a file

#Data manipulation

##Data subsetting

###`%in%`
A common task in exploratory data analysis is to ask whether a specific value or values exists in a larger R object.  For example you may want to know whether a specific gene name appears in a long list of names you've just read in.  To achieve this we can use the `%in%` command.

```{r eval=TRUE}
"BRCA1" %in% c("RAS", "MYC", "BRCA1", "TP53")
```

In the case above we were only interested in a single text query.  The example below demonstrates both that `%in%` is equally happy working with numeric values, and that a vector of queries can be used in a single command.  Here a vector of `TRUE` or `FALSE` values the same length as the number of queries will be returned. This is far more efficient that trying each in turn.

```{r eval=TRUE}
c(1,5,11) %in% 1:10
```

###match,

While the `%in%` command is useful for telling you whether a query appears somewhere, it doesn't specify where in the subject you will find it.  However there are several ways to achieve just this, where perhaps the most straightforward is `which()`.

```{r eval=TRUE}
which(c("RAS", "MYC", "BRCA1", "TP53") == "BRCA1")
```

However this approach falls down if one is interested in multiple queries.
```{r eval=TRUE}
which(c("RAS", "MYC", "BRCA1", "TP53") == c("BRCA1", "RAS"))
```
To avoid the confusion this could cause, it is better the employ the function `match()`


```{r eval=TRUE}
match(x = c("BRCA1", "MYC"), table = c("RAS", "MYC", "BRCA1", "TP53"))
```

###grep 


##Re-ordering data frames

##Adding new columns / variables

##Calculating summary statistics

##apply, tapply, aggregate

#Plotting

##The plot function

`plot` is the generic function in R

##Exporting a plot

R is able to save graphics in a variety of formats..

##Changing the plot appearance

How the `par` function works....

##Creating a layout

`par(mfrow=c...)`

##Adding a legend

`legend("topleft"....)


#Appendix

##Vectors

##Data Frames

##Factors

##Subsetting

##Functions

##Useful functions to know

##R version details

The version of R and the packages used in this document are given below.


```{r}
sessionInfo()
```

